<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Terrazas de Bayona - Alojamiento en La Habana</title>
    <!-- Carga de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Configuraci√≥n de la fuente Inter y estilos personalizados -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f7;
        }
        .content-container {
            max-width: 1200px;
        }
        .hero-text-shadow {
            text-shadow: 2px 2px 6px rgba(0, 0, 0, 0.8);
        }
        /* Clase inicial para la animaci√≥n de revelaci√≥n */
        .animate-on-scroll {
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 0.8s ease-out, transform 0.8s ease-out;
        }
        /* Clase para el estado final de la animaci√≥n */
        .scrolled-in {
            opacity: 1;
            transform: translateY(0);
        }
        /* Estilos para las estrellas de calificaci√≥n (de derecha a izquierda) */
        .star-rating {
            direction: rtl;
            display: inline-flex;
        }
        .star-rating label {
            cursor: pointer;
            font-size: 1.5rem;
            color: #d1d5db;
            transition: color 0.2s;
            direction: ltr; /* Reset de direcci√≥n para el s√≠mbolo */
        }
        /* Colorea las estrellas seleccionadas y las anteriores en amarillo */
        .star-rating input:checked ~ label,
        .star-rating label:hover,
        .star-rating label:hover ~ label {
            color: #f59e0b;
        }
        .star-rating input {
            display: none;
        }
        /* Estilo para la cabecera fija */
        #main-header {
            top: 0;
            width: 100%;
            z-index: 20;
        }
    </style>
</head>
<body class="text-gray-800">

    <!-- CABECERA Y NAVEGACI√ìN -->
    <header id="main-header" class="bg-white shadow-md sticky top-0 z-20">
        <div class="content-container mx-auto px-4 py-3 flex justify-between items-center">
            <a href="#" class="text-2xl font-bold text-teal-600 hover:text-teal-800 transition duration-300">
                Terrazas de Bayona
            </a>
            
            <!-- Men√∫ Desktop -->
            <nav class="hidden md:flex items-center space-x-6">
                <a href="#ubicacion" class="text-sm font-medium text-gray-600 hover:text-teal-600 transition">Ubicaci√≥n</a>
                <a href="#alojamiento" class="text-sm font-medium text-gray-600 hover:text-teal-600 transition">Alojamiento</a>
                <a href="#opiniones" class="text-sm font-medium text-gray-600 hover:text-teal-600 transition">Opiniones</a>
                <a href="#contacto" class="text-sm font-medium text-gray-600 hover:text-teal-600 transition duration-300">
                    Cont√°ctanos: +53 53893144
                </a>
            </nav>

            <!-- Bot√≥n M√≥vil -->
            <button id="mobile-menu-button" class="md:hidden p-2 text-gray-600 hover:text-teal-600 rounded-lg transition duration-300">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
            </button>
        </div>
        
        <!-- Men√∫ M√≥vil -->
        <div id="mobile-menu" class="hidden md:hidden px-4 pb-4 bg-gray-50 border-t border-gray-200">
            <a href="#ubicacion" class="block py-2 text-sm font-medium text-gray-700 hover:text-teal-600">Ubicaci√≥n</a>
            <a href="#alojamiento" class="block py-2 text-sm font-medium text-gray-700 hover:text-teal-600">Alojamiento</a>
            <a href="#opiniones" class="block py-2 text-sm font-medium text-gray-700 hover:text-teal-600">Opiniones</a>
            <a href="#contacto" class="block py-2 text-sm font-medium text-gray-700 hover:text-teal-600">Cont√°ctanos</a>
        </div>
    </header>

    <!-- SECCI√ìN HERO -->
    <section class="relative h-[60vh] md:h-[80vh] bg-cover bg-center flex items-center justify-center" 
             style="background-image: url('https://placehold.co/1200x800/228b7e/ffffff?text=Terrazas+de+Bayona+Habana');">
        <div class="absolute inset-0 bg-black opacity-40"></div>
        <div class="relative text-center text-white p-6 animate-on-scroll">
            <h1 class="text-4xl md:text-6xl font-extrabold mb-4 hero-text-shadow">
                Terrazas de Bayona
            </h1>
            <p class="text-xl md:text-2xl font-light hero-text-shadow max-w-2xl mx-auto">
                Tu hogar perfecto en La Habana. Comodidad, tranquilidad y una experiencia aut√©ntica.
            </p>
        </div>
    </section>

    <!-- SECCI√ìN UBICACI√ìN -->
    <section id="ubicacion" class="py-16 bg-white">
        <div class="content-container mx-auto px-4">
            <h2 class="text-3xl font-bold text-center text-teal-700 mb-12 animate-on-scroll">
                Ubicaci√≥n Inmejorable
            </h2>
            <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-8 text-center">
                <div class="p-6 bg-gray-50 rounded-xl shadow-lg hover:shadow-xl transition duration-300 transform hover:-translate-y-1 animate-on-scroll">
                    <div class="text-4xl text-teal-600 mb-3">üìç</div>
                    <p class="font-semibold text-lg">A 10 minutos a pie</p>
                    <p class="text-gray-600">Del centro de la ciudad de La Habana Vieja.</p>
                </div>
                <div class="p-6 bg-gray-50 rounded-xl shadow-lg hover:shadow-xl transition duration-300 transform hover:-translate-y-1 animate-on-scroll">
                    <div class="text-4xl text-teal-600 mb-3">üçΩÔ∏è</div>
                    <p class="font-semibold text-lg">Comida Local</p>
                    <p class="text-gray-600">Excelentes opciones gastron√≥micas cerca.</p>
                </div>
                <div class="p-6 bg-gray-50 rounded-xl shadow-lg hover:shadow-xl transition duration-300 transform hover:-translate-y-1 animate-on-scroll">
                    <div class="text-4xl text-teal-600 mb-3">üöå</div>
                    <p class="font-semibold text-lg">F√°cil Acceso</p>
                    <p class="text-gray-600">Cerca de la parada de autob√∫s a la playa.</p>
                </div>
                <div class="p-6 bg-gray-50 rounded-xl shadow-lg hover:shadow-xl transition duration-300 transform hover:-translate-y-1 animate-on-scroll">
                    <div class="text-4xl text-teal-600 mb-3">üõçÔ∏è</div>
                    <p class="font-semibold text-lg">Mercado</p>
                    <p class="text-gray-600">Cerca de mercados y tiendas.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- SECCI√ìN SOBRE NOSOTROS -->
    <section class="py-16 bg-white border-t border-gray-100">
        <div class="content-container mx-auto px-4 grid md:grid-cols-2 gap-12 items-center">
            <div class="order-2 md:order-1 animate-on-scroll">
                <img src="https://placehold.co/600x400/80cbc4/000000?text=Alexander+e+Isaida" 
                     alt="Alexander e Isaida"
                     class="w-full h-auto rounded-xl shadow-2xl object-cover">
            </div>
            <div class="order-1 md:order-2 animate-on-scroll">
                <h2 class="text-3xl font-bold text-teal-700 mb-4">Sobre nosotros</h2>
                <p class="text-gray-700 mb-4 leading-relaxed">
                    Somos Alexander e Isaida, una pareja con 16 a√±os de casados. Nos encanta compartir nuestras pasiones y crear un ambiente c√°lido y acogedor.
                </p>
                <p class="text-gray-700 mb-4 leading-relaxed">
                    Valoramos la comodidad de estar en casa y disfrutamos cocinando para nuestros hu√©spedes. ¬°Esperamos conocerte pronto!
                </p>
            </div>
        </div>
    </section>

    <!-- SECCI√ìN DE ALOJAMIENTO/INSTALACIONES Y PRECIOS -->
    <section id="alojamiento" class="py-16 bg-white">
        <div class="content-container mx-auto px-4 grid md:grid-cols-2 gap-12">
            <!-- Instalaciones -->
            <div class="animate-on-scroll">
                <h3 class="text-2xl font-bold text-teal-700 mb-6">Instalaciones</h3>
                <ul class="grid grid-cols-2 gap-y-4 text-gray-700">
                    <li class="flex items-center"><span class="text-teal-500 mr-2">‚úîÔ∏è</span>Agua caliente</li>
                    <li class="flex items-center"><span class="text-teal-500 mr-2">‚úîÔ∏è</span>Aire acondicionado</li>
                    <li class="flex items-center"><span class="text-teal-500 mr-2">‚úîÔ∏è</span>2 terrazas</li>
                    <li class="flex items-center"><span class="text-teal-500 mr-2">‚úîÔ∏è</span>Ba√±o privado</li>
                    <li class="flex items-center"><span class="text-teal-500 mr-2">‚úîÔ∏è</span>Wi-Fi</li>
                    <li class="flex items-center"><span class="text-teal-500 mr-2">‚úîÔ∏è</span>Cocina compartida</li>
                </ul>
            </div>

            <!-- Precios -->
            <div class="animate-on-scroll">
                <h3 class="text-2xl font-bold text-teal-700 mb-6">Precios</h3>
                <div class="bg-teal-50 p-6 rounded-xl shadow-lg">
                    <p class="text-xl font-semibold mb-4 text-teal-800">Habitaci√≥n privada:</p>
                    <ul class="space-y-3 text-gray-700">
                        <li class="flex justify-between border-b pb-2">
                            <span class="font-medium">1-6 noches:</span>
                            <span class="font-bold text-teal-600">25 USD/noche</span>
                        </li>
                        <li class="flex justify-between border-b pb-2">
                            <span class="font-medium">1-2 semanas:</span>
                            <span class="font-bold text-teal-600">20 USD/noche</span>
                        </li>
                        <li class="flex justify-between">
                            <span class="font-medium">15+ noches:</span>
                            <span class="font-bold text-teal-600">15 USD/noche</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </section>

    <!-- SECCI√ìN DE OPINIONES (CON FORMULARIO Y LISTA DE FIREBASE) -->
    <section id="opiniones" class="py-16 bg-gray-50 border-t border-gray-200">
        <div class="content-container mx-auto px-4">
            <h2 class="text-3xl font-bold text-center text-teal-700 mb-10 animate-on-scroll">
                Opiniones de nuestros hu√©spedes
            </h2>

            <!-- 1. Formulario de Opini√≥n -->
            <div class="max-w-2xl mx-auto mb-16 animate-on-scroll">
                <div class="bg-white p-8 rounded-xl shadow-xl">
                    <h3 class="text-xl font-bold text-gray-800 mb-6 text-center">D√©janos tu opini√≥n</h3>
                    <form id="review-form">
                        <div class="mb-4">
                            <label for="review-name" class="block text-gray-700 text-sm font-bold mb-2">Nombre</label>
                            <input type="text" id="review-name" placeholder="Tu nombre" class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:border-teal-500" required>
                        </div>
                        
                        <div class="mb-4 text-center">
                            <label class="block text-gray-700 text-sm font-bold mb-2">Calificaci√≥n</label>
                            <div class="star-rating justify-center">
                                <!-- Las etiquetas tienen un "for" que apunta al input (ej: star5). Esto permite marcar al hacer click. -->
                                <input type="radio" id="star5" name="rating" value="5" required><label for="star5" title="5 estrellas">‚òÖ</label>
                                <input type="radio" id="star4" name="rating" value="4"><label for="star4" title="4 estrellas">‚òÖ</label>
                                <input type="radio" id="star3" name="rating" value="3"><label for="star3" title="3 estrellas">‚òÖ</label>
                                <input type="radio" id="star2" name="rating" value="2"><label for="star2" title="2 estrellas">‚òÖ</label>
                                <input type="radio" id="star1" name="rating" value="1"><label for="star1" title="1 estrella">‚òÖ</label>
                            </div>
                        </div>

                        <div class="mb-6">
                            <label for="review-text" class="block text-gray-700 text-sm font-bold mb-2">Tu experiencia</label>
                            <textarea id="review-text" rows="3" placeholder="Cu√©ntanos qu√© te pareci√≥..." class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:border-teal-500" required></textarea>
                        </div>
                        
                        <!-- BOT√ìN DESHABILITADO POR DEFECTO HASTA CONEXI√ìN FIREBASE -->
                        <button type="submit" id="submit-btn" class="w-full bg-gray-400 text-white font-bold py-3 rounded-lg transition duration-300 shadow-md" disabled>
                            Conectando...
                        </button>
                        <p id="form-message" class="text-center mt-4 text-sm font-semibold hidden"></p>
                    </form>
                </div>
            </div>

            <!-- 2. Lista de Opiniones (Contenedor cargado por JS) -->
            <div id="reviews-container" class="grid md:grid-cols-2 gap-6">
                <div class="col-span-2 text-center text-gray-500 italic">Cargando opiniones...</div>
            </div>
        </div>
    </section>

    <!-- CONTACTO -->
    <section id="contacto" class="py-16 bg-teal-600 text-white text-center">
        <div class="content-container mx-auto px-4 animate-on-scroll">
            <h2 class="text-3xl font-bold mb-4">¬øListo para visitar Cuba?</h2>
            <p class="text-xl mb-8 font-light">Cont√°ctanos directamente por WhatsApp.</p>
            <a href="https://wa.me/53893144" target="_blank" class="inline-block bg-white text-teal-600 px-8 py-3 rounded-full font-bold shadow-lg hover:bg-gray-100 transition transform hover:scale-105">
                WhatsApp: +53 893144
            </a>
        </div>
    </section>

    <footer class="bg-gray-800 text-white py-6 text-center">
        <p>&copy; 2025 Terrazas de Bayona. Todos los derechos reservados.</p>
    </footer>

    <!-- L√ìGICA DE FIREBASE (Autenticaci√≥n y Firestore) -->
    <script type="module">
        // Importaciones de Firebase desde CDN actualizado (Modular API v12.6.0)
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, onSnapshot, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

        // --- MANEJO DE CONFIGURACI√ìN GLOBAL ---
        // Se utilizan las variables globales proporcionadas por el entorno (Canvas)
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : null;
        const APP_ID = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        let db, auth, userId = null; // Inicializar userId a null
        let isAuthReady = false; // Bandera para saber si la autenticaci√≥n ha terminado
        const submitBtn = document.getElementById('submit-btn');

        // Funci√≥n de utilidad para sanitizar HTML (prevenir XSS)
        function escapeHtml(text) {
            if (!text) return "";
            return text.toString()
                       .replace(/&/g, "&amp;")
                       .replace(/</g, "&lt;")
                       .replace(/>/g, "&gt;")
                       .replace(/"/g, "&quot;")
                       .replace(/'/g, "&#039;");
        }
        
        // Maneja el estado del bot√≥n del formulario
        function updateFormState(ready) {
            isAuthReady = ready;
            if (ready) {
                submitBtn.disabled = false;
                submitBtn.textContent = "Publicar Opini√≥n";
                submitBtn.classList.add('bg-teal-600', 'hover:bg-teal-700');
                submitBtn.classList.remove('bg-gray-400');
            } else {
                submitBtn.disabled = true;
                submitBtn.textContent = "Conectando...";
                submitBtn.classList.remove('bg-teal-600', 'hover:bg-teal-700');
                submitBtn.classList.add('bg-gray-400');
            }
        }

        // 1. Inicializa Firebase y realiza la autenticaci√≥n
        async function initApp() {
            updateFormState(false); 

            if (!firebaseConfig) {
                console.error("Firebase Configuraci√≥n no disponible.");
                document.getElementById('reviews-container').innerHTML = '<div class="col-span-2 text-center text-red-600 p-4 rounded-xl bg-red-100">Error: La configuraci√≥n de Firebase no se pudo cargar correctamente.</div>';
                return;
            }

            try {
                // Inicializa Firebase
                const app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);

                // Monitorear el estado de autenticaci√≥n (se dispara despu√©s del sign-in)
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        userId = user.uid;
                        updateFormState(true); // Habilitar el bot√≥n y establecer isAuthReady = true
                        loadReviews(); // Cargar opiniones
                    } else {
                        // Si el usuario cierra sesi√≥n o la autenticaci√≥n falla por alguna raz√≥n.
                        userId = null;
                        updateFormState(false); // Deshabilitar el bot√≥n y establecer isAuthReady = false
                        document.getElementById('reviews-container').innerHTML = '<div class="col-span-2 text-center text-gray-500 italic">Esperando autenticaci√≥n...</div>';
                    }
                });

                // L√ìGICA DE AUTENTICACI√ìN:
                // Intentar iniciar sesi√≥n con la ficha personalizada o de forma an√≥nima
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }

            } catch (e) {
                console.error("Error al inicializar o autenticar Firebase.", e);
                let errorMsg = 'Error al conectar la base de datos. Verifica las reglas de seguridad de Firestore.';
                document.getElementById('reviews-container').innerHTML = `<div class="col-span-2 text-center text-red-600 p-4 rounded-xl bg-red-100">${errorMsg}</div>`;
                updateFormState(false);
            }
        }

        // 2. Cargar opiniones en tiempo real (onSnapshot)
        function loadReviews() {
            if (!db || !APP_ID || !userId) return; // Asegurar que la DB y el Auth est√©n listos
            const container = document.getElementById('reviews-container');
            const colRef = collection(db, 'artifacts', APP_ID, 'public', 'data', 'reviews');
            
            // onSnapshot crea una conexi√≥n en tiempo real
            onSnapshot(query(colRef), (snapshot) => {
                const reviews = [];
                snapshot.forEach(doc => reviews.push({ id: doc.id, ...doc.data() }));

                // Ordenar por fecha (m√°s reciente primero)
                reviews.sort((a, b) => (b.timestamp?.seconds || 0) - (a.timestamp?.seconds || 0));

                if (reviews.length === 0) {
                    container.innerHTML = '<div class="col-span-2 text-center text-gray-500 p-4">S√© el primero en opinar.</div>';
                    return;
                }

                container.innerHTML = reviews.map(r => {
                    const rating = parseInt(r.rating) || 5;
                    // Genera estrellas amarillas (‚òÖ) y vac√≠as (‚òÜ)
                    const stars = '‚òÖ'.repeat(rating) + '‚òÜ'.repeat(5 - rating);
                    const date = r.timestamp ? new Date(r.timestamp.seconds * 1000).toLocaleDateString() : 'Reciente';

                    return `
                        <div class="bg-white p-6 rounded-xl shadow-md border-l-4 border-teal-500 animate-on-scroll scrolled-in">
                            <div class="text-yellow-400 text-xl mb-2">${stars}</div>
                            <p class="text-gray-700 italic mb-4">"${escapeHtml(r.reviewText)}"</p>
                            <div class="text-right">
                                <span class="font-bold text-teal-600 block">- ${escapeHtml(r.name)}</span>
                                <span class="text-xs text-gray-400">${date}</span>
                            </div>
                        </div>
                    `;
                }).join('');
            }, (error) => {
                console.error("Error al escuchar opiniones:", error);
                container.innerHTML = '<div class="col-span-2 text-center text-red-600 p-4 rounded-xl bg-red-100">Error de permisos: Revisa las Reglas de Seguridad de Firestore.</div></div>';
            });
        }

        // 3. Enviar opini√≥n a Firestore
        document.getElementById('review-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const msg = document.getElementById('form-message');
            
            // Comprobaci√≥n de estado de autenticaci√≥n (LA CORRECCI√ìN CLAVE)
            if (!isAuthReady || !userId) {
                msg.textContent = "Conexi√≥n pendiente. Por favor, espera un momento y vuelve a intentarlo.";
                msg.className = "text-center mt-4 text-sm font-semibold text-orange-600";
                msg.classList.remove('hidden');
                setTimeout(() => msg.classList.add('hidden'), 5000);
                return;
            }

            const name = document.getElementById('review-name').value.trim();
            const text = document.getElementById('review-text').value.trim();
            const rating = document.querySelector('input[name="rating"]:checked')?.value || '5';

            if (name.length === 0 || text.length === 0) return;

            submitBtn.disabled = true;
            submitBtn.textContent = "Enviando...";
            msg.classList.add('hidden'); // Ocultar mensaje anterior

            try {
                // Se utiliza el APP_ID para construir la ruta correcta
                await addDoc(collection(db, 'artifacts', APP_ID, 'public', 'data', 'reviews'), {
                    name,
                    reviewText: text,
                    rating: parseInt(rating),
                    userId,
                    timestamp: serverTimestamp()
                });
                
                // √âxito
                e.target.reset();
                msg.textContent = "¬°Gracias por tu opini√≥n! Se ha publicado con √©xito.";
                msg.className = "text-center mt-4 text-sm font-semibold text-green-600";
                msg.classList.remove('hidden');
                setTimeout(() => msg.classList.add('hidden'), 5000);
            } catch (err) {
                // Error
                console.error("Error al a√±adir documento:", err);
                msg.textContent = "Error al enviar. Aseg√∫rate de que las Reglas de Seguridad de Firestore permitan la escritura (write).";
                msg.className = "text-center mt-4 text-sm font-semibold text-red-600";
                msg.classList.remove('hidden');
            } finally {
                updateFormState(true); // Restaurar estado del bot√≥n
            }
        });

        // 4. Inicializaci√≥n y Eventos DOM
        document.addEventListener('DOMContentLoaded', () => {
            // Inicializaci√≥n de la aplicaci√≥n de Firebase
            initApp();
            
            // --- L√≥gica para desplazamiento (Scroll Reveal) ---
            const observer = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('scrolled-in');
                        observer.unobserve(entry.target); // Dejar de observar una vez animado
                    }
                });
            }, { threshold: 0.1 });
            document.querySelectorAll('.animate-on-scroll').forEach(el => observer.observe(el));
            
            // Men√∫ m√≥vil
            const btn = document.getElementById('mobile-menu-button');
            const menu = document.getElementById('mobile-menu');
            btn.addEventListener('click', () => menu.classList.toggle('hidden'));

            // Desplazamiento suave para enlaces de navegaci√≥n
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    
                    const targetId = this.getAttribute('href').substring(1);
                    const targetElement = document.getElementById(targetId);

                    if (targetElement) {
                        // Usamos scrollIntoView para asegurar que se desplaza al inicio del elemento
                        targetElement.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start' 
                        });
                        
                        // Peque√±o ajuste despu√©s del scroll para compensar la cabecera fija
                        const headerHeight = document.getElementById('main-header').offsetHeight || 0;
                        window.scrollBy(0, -headerHeight - 8); // Ajuste fino
                    }
                });
            });
        });
    </script>
</body>
</html>
